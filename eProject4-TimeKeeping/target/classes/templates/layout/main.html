<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/springsecurity5">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title th:text="${title}">Time Keeping</title>
    <link rel="stylesheet" th:href="@{/home_assets/css/style.css}">
    <script src="../../static/home_assets/js/scripts-all.js"></script>
    <script src="../../static/home_assets/js/main.js"></script>
</head>
<body>
<div class="js-animsition animsition" id="site-wrap" data-animsition-in-class="fade-in"
     data-animsition-out-class="fade-out">

    <header th:fragment="header" class="templateux-navbar" role="banner"
            xmlns:th="http://www.thymeleaf.org">

        <div class="container" data-aos="fade-down">
            <div class="row">
                <div class="col-3 templateux-logo">
                    <a href="/home" class="animsition-link">
                        <img src="/img/logo.jpg" style="width: 250px">
                    </a>

                </div>
                <nav class="col-9 site-nav">
                    <button class="d-block d-md-none hamburger hamburger--spin templateux-toggle templateux-toggle-light ml-auto templateux-toggle-menu"
                            data-toggle="collapse" data-target="#mobile-menu" aria-controls="mobile-menu"
                            aria-expanded="false" aria-label="Toggle navigation">
                    <span class="hamburger-box">
                        <span class="hamburger-inner"></span>
                    </span>
                    </button>
                    <ul class="sf-menu templateux-menu d-none d-md-block">
                        <li class="active">
                            <a href="/home" class="animsition-link">Trang Chủ</a>
                        </li>
                        <li><a href="/about" class="animsition-link">Giới Thiệu</a></li>
                        <li><a href="/service" class="animsition-link">Tác Vụ</a></li>
                        <li><a href="/job" class="animsition-link">Việc Làm</a></li>
                        <li><a href="/contact" class="animsition-link">Liên Hệ</a></li>
                        <li>
                            <div class="dropdown show">
                                <a class="btn dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    Tài Khoản
                                </a>

                                <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                    <div id="logout-section" style="display:none;">
                                        <a id="profile-link" class="dropdown-item text-dark" href="#">Trang cá nhân</a>

                                        <a href="#" onclick="deleteAuthToken()" class="dropdown-item text-danger">Đăng xuất</a>
                                    </div>
                                    <a id="login-section" class="dropdown-item text-dark" th:href="@{/auth/login}">Đăng Nhập</a>
                                </div>
                            </div>

                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <script>
        // Hàm để xóa cookie AUTH-TOKEN
        function deleteAuthToken() {
            document.cookie = "AUTH-TOKEN=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            location.reload(); // Reload the page after logout to update the view
        }

        // Hàm để lấy cookie theo tên
        function getCookie(name) {
            let cookieArr = document.cookie.split(";");
            for (let i = 0; i < cookieArr.length; i++) {
                let cookiePair = cookieArr[i].split("=");
                if (name === cookiePair[0].trim()) {  // Trim to avoid spaces
                    return decodeURIComponent(cookiePair[1]);
                }
            }
            return null;
        }

        // Khi trang được tải, kiểm tra cookie và cập nhật hiển thị
        window.onload = function() {
            let authToken = getCookie("AUTH-TOKEN");
            let accountId = getCookie("ACCOUNT-ID");

            let logoutSection = document.getElementById("logout-section");
            let loginSection = document.getElementById("login-section");
            let profileLink = document.getElementById("profile-link");


            if (authToken && accountId) {
                profileLink.href = "/auth/profile?AccountId=" + accountId; // Set profile link
                console.log("Profile link set to: " + profileLink.href);
                logoutSection.style.display = "block"; // Show logout section
                loginSection.style.display = "none";  // Hide login section
            } else {
                logoutSection.style.display = "none"; // Hide logout section
                loginSection.style.display = "block"; // Show login section
                profileLink.href = "/auth/login"; // Set default login link
                console.log("Profile link set to login: " + profileLink.href);
            }
            // Log the values of the cookies
            console.log("AUTH-TOKEN: " + authToken);
            console.log("ACCOUNT-ID: " + accountId);
        };
    </script>

    <main layout:fragment="content">Nothing</main>

    <footer th:replace="~{layout/footer :: footer}"></footer>

</div> <!-- .js-animsition -->

<script th:src="@{/home_assets/js/scripts-all.js}"></script>
<script th:src="@{/home_assets/js/main.js}"></script>

</body>
</html>