<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">

<head>
    <meta charset="utf-8" />
    <title th:text="${pageTitle}">Lịch Làm Việc</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        th {
            background-color: #4fba69 !important;
            color: #fff;
            text-align: center;
            vertical-align: middle;
        }

        .templateux-navbar {
            position: relative !important;
            padding: 0 !important;
            background-color: #f8f9fa !important;
        }

        .templateux-navbar .templateux-menu a {
            text-decoration: none;
            color: #333 !important;
        }

        .templateux-navbar .templateux-menu>li.active>a {
            color: #3d3d3d !important;
        }

        .templateux-navbar .templateux-logo {
            margin-top: 0 !important;
        }
        .templateux-navbar .templateux-menu a:active, .templateux-navbar .templateux-menu a:focus, .templateux-navbar .templateux-menu a:hover {
            color: #333;
            background-color: #f1f1f1 !important;
        }
    </style>
</head>

<body>
<div layout:fragment="content">
    <div class="row g-4 my-5">
        <div class="col-12">
            <h1 class="text-center">
                ĐĂNG KÝ LỊCH LÀM VIỆC
            </h1>
        </div>
    </div>
    <form action="/workSchedules/register" method="get">
        <div class="row g-4">
            <div class="col-8"></div>
            <div class="col-4">
                <div class="input-group">

                    <input type="week" class="form-control" id="week" name="week" value="">

                    <button class="btn btn-outline-secondary" type="submit">
                        Lọc
                    </button>
                </div>
            </div>
        </div>
    </form>
    <div class="row g-4">
        <div class="col-12">
            <div class="rounded h-100 my-4">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th style="vertical-align: middle;">Tên</th>
                            <th th:each="date : ${dateWithDayName}" style="font-weight: bolder">
                                <div th:text="${date.key}"></div>
                                <div th:text="${date.value}"></div>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td th:text="${acc.fullName}" style="text-align: center; vertical-align: middle; font-weight: bolder;"></td>
                            <td th:each="entry : ${scheduleMap}" style="text-align: center; vertical-align: middle;">
                                <div th:if="${entry.value != null && (entry.value.status == T(com.timekeeping.timekeeping.enums.ApprovalStatus).APPROVED || entry.value.status == T(com.timekeeping.timekeeping.enums.ApprovalStatus).REJECTED)}" th:text="${entry.value.shift.shiftName}"></div>
                                <div th:if="${entry.value != null && (entry.value.status != T(com.timekeeping.timekeeping.enums.ApprovalStatus).APPROVED && entry.value.status != T(com.timekeeping.timekeeping.enums.ApprovalStatus).REJECTED)}">
                                    <!-- Hiển thị thông tin ca làm việc -->
                                    <form
                                            th:action="@{/workSchedules/updateShift}"
                                            method="get"
                                    >
                                        <input type="hidden" name="register" th:value="yes"/>
                                        <input type="hidden" name="scheduleId" th:value="${entry.value.scheduleId}"/>
                                        <div class="input-group">
                                            <select
                                                    name="shiftId"
                                                    required
                                                    class="form-control"
                                            >
                                                <option
                                                        th:each="shiftOption : ${shifts}"
                                                        th:value="${shiftOption.shiftId}"
                                                        th:text="${shiftOption.shiftName}"
                                                        th:selected="${shiftOption.shiftId} == ${entry.value.shift.shiftId}"
                                                >
                                                    Chọn ca làm
                                                </option>
                                            </select>
                                            <button type="submit" class="btn btn-outline-success">
                                                <i class="far fa-check-square"></i>
                                            </button>
                                        </div>
                                    </form>
                                    <div>Status: <span th:text="${entry.value.status.displayName}"></span></div>
                                </div>
                                <div th:if="${entry.value == null}">
                                    <!-- Hiển thị form tạo ca làm việc mới -->
                                    <form
                                            th:action="@{/workSchedules/create}"
                                            method="post"
                                    >
                                        <input type="hidden" name="register" th:value="yes"/>
                                        <input type="hidden" name="scheduleId"/>
                                        <input type="hidden" name="date" th:value="${entry.key}"/>
                                        <input type="hidden" name="accountId" th:value="${acc.accountID}"/>
                                        <div class="input-group">
                                            <select
                                                    name="shiftId"
                                                    required
                                                    class="form-control"
                                            >
                                                <option value="" disabled selected>Chọn ca làm</option>
                                                <option
                                                        th:each="shiftOption : ${shifts}"
                                                        th:value="${shiftOption.shiftId}"
                                                        th:text="${shiftOption.shiftName}"
                                                >
                                                    Chọn ca làm
                                                </option>
                                            </select>
                                            <button type="submit" class="btn btn-outline-success">
                                                <i class="far fa-plus-square"></i>
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>


</body>

</html>