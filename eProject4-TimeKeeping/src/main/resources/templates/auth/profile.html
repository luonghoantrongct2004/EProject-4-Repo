<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}">Profile</title>
</head>
<body style="background-image: url('https://imgs.search.brave.com/4nLMXgCOnsi3gGsNZT8Re-BdhQ6a7w4SHsYVE7QN0dU/rs:fit:500:0:0:0/g:ce/aHR0cHM6Ly9pbWcu/ZnJlZXBpay5jb20v/ZnJlZS1waG90by9h/YnN0cmFjdC1uZXR3/b3JraW5nLWNvbmNl/cHQtc3RpbGwtbGlm/ZS1hcnJhbmdlbWVu/dF8yMy0yMTQ5MDM1/NzA5LmpwZz9zaXpl/PTYyNiZleHQ9anBn'); background-size: contain;">
<div  layout:fragment="content" >
<div class="container-fluid" style="padding-top: 220px; padding-bottom: 50px;">

    <div class="row">
        <!-- Cột trái chứa các liên kết điều hướng -->
        <div class="col-md-4">
            <div class="list-group">
                <a href="/profile?AccountId=${account.accountID}" class="list-group-item list-group-item-action active">Thông tin cá nhân</a>
                <a th:href="@{/attendance/show(accountID=${account.accountID})}" class="list-group-item list-group-item-action">Bảng chấm công</a>
                <a href="/settings" class="list-group-item list-group-item-action">Bảng lương</a>
            </div>
        </div>

        <!-- Cột phải hiển thị thông tin tài khoản và form đổi mật khẩu -->
        <div class="col-md-8">
            <div class="alert alert-success alert-dismissible fade show" th:if="${success}" th:text="${success}" id="successAlert"></div>
            <div class="alert alert-danger alert-dismissible fade show" th:if="${error}" th:text="${error}" id="errorAlert"></div>

            <script>
                // Thời gian tự động tắt thông báo (5 giây = 5000ms)
                setTimeout(function() {
                    var successAlert = document.getElementById('successAlert');
                    if (successAlert) {
                        successAlert.classList.remove('show');
                        successAlert.classList.add('fade');
                    }
                }, 3000); // Tự động tắt sau 5 giây

                setTimeout(function() {
                    var errorAlert = document.getElementById('errorAlert');
                    if (errorAlert) {
                        errorAlert.classList.remove('show');
                        errorAlert.classList.add('fade');
                    }
                }, 3000);
            </script>
            <!-- Thông tin tài khoản -->
            <div class="card mb-4">
                <div class="card-header">
                    Thông tin tài khoản
                </div>
                <div class="card-body">
                    <p><strong>Email:</strong> <span th:text="${account.email}">user@example.com</span></p>
                    <p><strong>Tên:</strong> <span th:text="${account.fullName}">Tên</span></p>
                    <p><strong>Vai trò:</strong> <span th:text="${account.role.name}">Người dùng</span></p>
                </div>
            </div>

            <!-- Form thay đổi mật khẩu -->
            <div class="card">
                <div class="card-header">
                    Đổi mật khẩu
                </div>
                <div class="card-body">
                    <form action="/auth/change-password" method="post" id="form-change" onsubmit="return validatePassword()">
                        <div class="alert alert-danger" th:if="${error}" th:text="${error}"></div>
                        <input type="hidden" name="accountID" th:value="${account.accountID}"/>
                        <div class="form-group">
                            <label for="currentPassword">Mật khẩu hiện tại</label>
                            <input type="password" class="form-control" id="currentPassword" name="currentPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">Mật khẩu mới</label>
                            <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Xác nhận mật khẩu mới</label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                            <small id="passwordError" class="text-danger" style="display:none;">Mật khẩu không khớp!</small>
                        </div>
                        <button type="submit" class="btn btn-primary" onclick="return validatePassword()">Đổi mật khẩu</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        function validatePassword() {
            // Lấy giá trị của hai trường mật khẩu
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // So sánh mật khẩu mới và mật khẩu xác nhận
            if (newPassword !== confirmPassword) {
                // Nếu không khớp, hiển thị thông báo lỗi
                document.getElementById('passwordError').style.display = 'block';
                return false; // Ngăn việc submit form
            } else {
                // Nếu khớp, ẩn thông báo lỗi (nếu có)
                document.getElementById('passwordError').style.display = 'none';
                return true; // Cho phép submit form
            }
        }
    </script>
</div>
</div>
</body>
</html>
